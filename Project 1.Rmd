---
title: "Project 1"
author: "Jaret Mrochek"
date: "2/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo= FALSE, include=FALSE}
library(readr)
ncaa_data <- read_table2("basketball_use.dat", 
    col_names = FALSE)
colnames(ncaa_data) = c("year", "w_team", "w_score", "l_team", "l_score")
```
This This dataset contains all NCAA D1 Tournament basketball games from 1939 - 1995, with 1706 games observed. 5 variables were tracked for each game: year, winning team, winning score, losing team, and losing score. For this project we were focused on the total score of each game.
```{r echo = FALSE}
head(ncaa_data)
```

Calculating the average total score of each game by adding up all the scores in the
l_score and w_score columns. Then dividing them by the length: 1706 in this case.
```{r echo = FALSE}
#Average total score in each game
avgTotalScore <- (sum(ncaa_data$w_score) + sum(ncaa_data$l_score)) / length(ncaa_data$w_score)
print(avgTotalScore)
```

Creating a histogram of the total scores. With a y-axis of frequency, aka how many times did this score occur. 
```{r}
#making a histogram of total score
totalScores <- c(0)
totalScores <- ncaa_data$w_score + ncaa_data$l_score

hist(x = totalScores, freq = TRUE, main = "Histogram of total game scores", xlab = "Score", ylab = "Frequency")
```

Here is a boxplot of the total scores. This is a great way of showing where the first quartile, third quartile, median, and where outliers are in our data.
```{r}
boxplot(totalScores, horizontal = TRUE, main = "Boxplot of total score")
```

Using estimators from lab two, we discored that our alpha was around 30.712, and beta was 4.6727. From here we were able to generate a gamma distribution that described our data quite well. 
```{r}
#Estimating a gamma
xbar <- avgTotalScore
xSquaredBar <- mean((ncaa_data$w_score + ncaa_data$l_score)^2)

alpha <- xbar^2 / (xSquaredBar - xbar^2)
beta <- avgTotalScore / alpha


hist(x = totalScores, probability = TRUE, main = "Histogram of total game scores w/Gamma curve", xlab = "Score", ylab = "Frequency", ylim = c(0, .017))
box()
curve(dgamma(x = x, shape = alpha, scale = beta), add = TRUE)
alpha
beta
```

Another way to show how accurate our gamma distribution works is through a QQ-Plot. Here the blue line represents where we should expect to see scores that follow our gamma estimation. Each point represents a score from our data. As you can see these points follow quite well with our gamma destribution. With an exception for our outliers near the tails of our data.
```{r}
#QQ-Plot
qqplot(x = qgamma(p = ppoints(totalScores), shape = alpha, scale = beta), 
       y = totalScores,
       main = "Total Scores, gamma dist",
       xlab = "Theoretical total score Gamma",
       ylab = "Sample total score")
abline(a = 0, b = 1, col = "blue")
grid()
```

This normal curve was generated by using the mean from our data and calculating a standard deviation. 
```{r}
hist(x = totalScores, probability = TRUE, main = "Histogram of total game scores w/Normal Curve", xlab = "Score", ylab = "Frequency", ylim = c(0, .017))
box()
curve(dnorm(x = x, mean = avgTotalScore, sd = sqrt(var(totalScores))), add = TRUE)
```

Below is our QQ-Plot with our data and our normal distribution. Since this line was calculated directly from our data it fits quite nicely. Much better on the tails than the gamma distribution.
```{r}
qqplot(x = qnorm(p = ppoints(totalScores), mean = avgTotalScore, sd = sqrt(var(totalScores))), 
       y = totalScores,
       main = "Total Scores, normal dist",
       xlab = "Theoretical total score normal",
       ylab = "Sample total score")
abline(a = 0, b = 1, col = "blue")
grid()
```

Here is a chart of every total score in our data set. We were looking to see if we could see any trends in our data. For example as the years went on, did games have more scoring as athletes improved? Is there a growth or decay in scoring? The chart below shows how scoring has behaved throughout the years. 
```{r}
#trend in total score
plot(x = ncaa_data$year, y = totalScores, type = "p", xlab = "Year", ylab = "Scores", main = "Trend in total scores through the years")
```

Now, there has been a general increase in scoring. But overall between ~1950 to ~1985. The chunk of points is around the same. But there is a jump after 1986. What could have lead to this first increase? Most likely it began as athletes started specializing in only one sport. Or the addition of positions and peole of certain sizes gravitating towards those positions. For example the center or "big man" position is now dominated by the biggest guys in the league. This transition started in the mid 1900's. Coaching and strategy also led to this first increase in scoring, as people realized that there is certain way to play basketball. From running plays to pick'n'rolls. But one of the biggest influencers of scoring that changed the game forever happened in 1986. That is when the 3 point line was added in the NCAA. It's difficult to see withough the blue line we added. But when we add the line the jump in quite clear. Games that scores less than 80 points combined are almost extinct, and it became more and more common for teams to combine for close to 200 points. This is also the era where we see our higheset scoring tournament game of 264 points. 

```{r echo = FALSE}
#trend in total score
plot(x = ncaa_data$year, y = totalScores, type = "p", xlab = "Year", ylab = "Scores", main = "Trend in total scores through the years")
abline(v = 1986, col = "blue")
legend(x = 1940, y = 250, legend = "Three point line added", col = "blue", lty = 1)
#reason for this? Most likely due to increase in specialization in sports throughout peoples' childhoods. 
#College kids were significantly better athletes in the 90's than the 40's and 50's
#Also changes in coaching, strategy, addition of the 3-point line in 1986
```

Along with general scoring, we also looked at margin of victory. That is when teams won, how much did they win by. This vector was made by subtracting the w_score by the l_score. Here is the plot of the margins of victory. We were wonding if games got more competitive throughout the years. Or if the developement of blueblood schools like Duke, UK, UCLA etc. lead to more blowouts. 
```{r}
#What is the margin of victory?
margin <- ncaa_data$w_score - ncaa_data$l_score
plot(x = c(1:1706), y = margin, type = 'p', xlab = "Game / year technically")
```
```{r}
averageMargin <- round(mean(margin), digits = 2)
print(averageMargin)
```

As shown above, it's all pretty much a blob. There is no trend in margin of victory. As tournament games feature the best teams in the nation that year. Blowouts happen, but most games are won by around 10 points. 

Going into some more team oriented data, we wanted to see which teams are the most successful? Which team lost the most? And most importantly, how does Ohio State look? Below is the team that won the most.
```{r echo = FALSE}
#Which is the most winningest team?
#https://stackoverflow.com/questions/48632957/how-to-find-the-most-repeated-word-in-a-vector-with-r
print(names(table(ncaa_data$w_team))[as.vector(table(ncaa_data$w_team)) == max(table(ncaa_data$w_team))])
print(max(table(ncaa_data$w_team)))
```

UCLA winning the most during this era is not a surprise at all. This stretch for them included winning the tournament 11 times. 10 times during an 11 year span, 7 in a row. An NCAA record and one of the best dynasty in sports history.

Now who's the biggest loser. 
```{r echo = FALSE}
#Who has the most losses?
print(names(table(ncaa_data$l_team))[as.vector(table(ncaa_data$l_team)) == max(table(ncaa_data$l_team))])
print(max(table(ncaa_data$l_team)))
```
The answer is Kentucky? Which comes as a surprise at first since UK is a “blueblood” basketball school. Why do they have so many losses? Because they’re consistently one of the best teams. They make the tournament every year, 64 teams make it and only 1 team won’t receive a loss. During this span, UK won 5 national titles, made the Final Four 10 times. So UK has the most losses, but this is due to how good of a team they are.

Finally, what's Ohio State's record.
```{r echo = FALSE}
#Whats OSU's record?
#https://stackoverflow.com/questions/7782113/count-word-occurrences-in-r
c(wins = length(grep("OHIO_STATE", ncaa_data$w_team)), losses = length(grep("OHIO_STATE", ncaa_data$l_team)))
```
With an average scoring of 
```{r echo = FALSE}
osuScores <- 0
j = 0;
for(i in seq_along(totalScores)){
  if(ncaa_data$w_team[i] == "OHIO_STATE"){
    osuScores[j] <- ncaa_data$w_score[i]
    j <- j+1
  }
  if(ncaa_data$l_team[i] == "OHIO_STATE"){
    osuScores[j] <- ncaa_data$l_score[i]
    j <- j+1
  }
}
intScores <- strtoi(osuScores)
avgOsuScore <- sum(intScores) / length(osuScores)
print(avgOsuScore)
```
points per game.